% Johann Diep (jdiep@student.ethz.ch) - May 2019

% This program reads and controls the Sniffer module.

clear 
clc

%% Closing and deleting ports

if ~isempty(instrfind)
    fclose(instrfind);
    delete(instrfind);   
end

%% Parameters

index = 0;
iterations = 100;
averaging_number = 50;
anchors = 6;
first_iteration = true;

%% Range aquisition form each anchor via TWR

port = seriallist;
serial = serial(port);
fopen(serial); % run sudo chmod 666 /dev/ttyACM* on console first

for i = 1:anchors

    fwrite(serial, "c");
    while index < iterations
        line = fgetl(serial);
       
        if first_iteration == true
            while ~strncmpi(line,"Anchor 1",8)
                line = fgetl(serial);
            end
            first_iteration = false;
        end
        
        if strncmpi(line,"Anchor",6)
            switch line(8)
                case "1"
                    line(
                case "2"
                case "3"
                case "4"
                case "5"
                case "6"
            end
        end
    end
       
       
       index = index + 1;
    end
    index = 0;
    fwrite(serial, "y");

end